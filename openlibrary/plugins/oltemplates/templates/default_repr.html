$def with (thing, property=None)
$if thing.is_primitive: $thing.value
$elif thing.type.kind == 'embeddable' or thing.key is None:
    <table>
    $for k in thing:
        <tr>
            <td>$k</td>
            <td>$:thingrepr(thing[k])</td>
        </tr>
    </table>
$else: <a href="$thing.key">$thing.key</a>