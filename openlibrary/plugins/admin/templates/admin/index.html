$def with (counts)

$ _x = ctx.setdefault('bodyid', 'admin')
$ _x = ctx.setdefault('usergroup', 'admin')

$:macros.Dashboard()
$ stats = get_admin_stats()
<script type="text/javascript"> 
\$(function () {
    var d = [[1196463600000, 100], [1196550000000, 543], [1196636400000, 234], [1196722800000, 77], [1196809200000, 636], [1196895600000, 575], [1196982000000, 736], [1197068400000, 186], [1197154800000, 676], [1197241200000, 205], [1197327600000, 906], [1197414000000, 710], [1197500400000, 639], [1197586800000, 540], [1197673200000, 435], [1197759600000, 301], [1197846000000, 575], [1197932400000, 481], [1198018800000, 591], [1198105200000, 608], [1198191600000, 459], [1198278000000, 234], [1198364400000, 352], [1198450800000, 686], [1198537200000, 279], [1198623600000, 449], [1198710000000, 468], [1198796400000, 392], [1198882800000, 282], [1198969200000, 208], [1199055600000, 229], [1199142000000, 177], [1199228400000, 374], [1199314800000, 436], [1199401200000, 404], [1199487600000, 253], [1199574000000, 218], [1199660400000, 476], [1199746800000, 462], [1199833200000, 448], [1199919600000, 442], [1200006000000, 403], [1200092400000, 204], [1200178800000, 194], [1200265200000, 327], [1200351600000, 374], [1200438000000, 507], [1200524400000, 546], [1200610800000, 482], [1200697200000, 283], [1200783600000, 221], [1200870000000, 483], [1200956400000, 523], [1201042800000, 528], [1201129200000, 483], [1201215600000, 452], [1201302000000, 270], [1201388400000, 222], [1201474800000, 439], [1201561200000, 559], [1201647600000, 521], [1201734000000, 477], [1201820400000, 442], [1201906800000, 252], [1201993200000, 236], [1202079600000, 525], [1202166000000, 477], [1202252400000, 386], [1202338800000, 409], [1202425200000, 408], [1202511600000, 237], [1202598000000, 193], [1202684400000, 357], [1202770800000, 414], [1202857200000, 393], [1202943600000, 353], [1203030000000, 364], [1203116400000, 215], [1203202800000, 214], [1203289200000, 356], [1203375600000, 399], [1203462000000, 334], [1203548400000, 348], [1203634800000, 243]];
    for (var i = 0; i < d.length; ++i)
      d[i][0] += 60 * 60 * 1000;
    function weekendAreas(axes) {
        var markings = [];
        var d = new Date(axes.xaxis.min);
        d.setUTCDate(d.getUTCDate() - ((d.getUTCDay() + 1) % 7))
        d.setUTCSeconds(0);
        d.setUTCMinutes(0);
        d.setUTCHours(0);
        var i = d.getTime();
        do {
            markings.push({ xaxis: { from: i, to: i + 2 * 24 * 60 * 60 * 1000 } });
            i += 7 * 24 * 60 * 60 * 1000;
        } while (i < axes.xaxis.max);
 
        return markings;
    }
    
    var options = {
       series: {
            bars: { 
                show: true, 
                fill: 1, 
                fillColor: "#748d36",
                color: "#748d36", 
                align: "left",
                barWidth: 24 * 60 * 60 * 1000
            },
            points: { 
                show: false 
            },
            color: "#748d36"
        },
        grid: { 
            hoverable: true,
            show: false
        },
        xaxis: { 
            mode: "time"
        }
    };
 
    var placeholder = \$("#edits");

    var plot = \$.plot(placeholder, [d], options);
    
    function showTooltip(x, y, contents) {
        \$('<div id="chartLabelA">' + contents + '</div>').css( {
            position: 'absolute',
            display: 'none',
            top: y + 12,
            left: x + 12,
            border: '1px solid #ccc',
            padding: '2px',
            backgroundColor: '#efefef',
            color: '#454545',
            fontSize: '11px',
            webkitBoxShadow: '1px 1px 3px #333',
            mozBoxShadow: '1px 1px 1px #000',
            boxShadow: '1px 1px 1px #000'
        }).appendTo("body").fadeIn(200);
    };
    var previousPoint = null;
    placeholder.bind("plothover", function (event, pos, item) {
        \$("#x").text(pos.x);
        \$("#y").text(pos.y.toFixed(0));
        if (item) {
            \$("#chartLabelA").remove();
            var milli = item.datapoint[0];
            var date = new Date(milli);
            var x = date.toDateString(),
                y = item.datapoint[1].toFixed(0);
            if (y == 1) {
                showTooltip(item.pageX, item.pageY,
                    y + " edit on " + x);
            } else {
                 showTooltip(item.pageX, item.pageY,
                    y + " edits on " + x);
            };
        } else {
            \$("#chartLabelA").remove();
        };
    });
});
</script> 

<div id="contentHead">
    <div class="contentRight" style="float:right;">
        <table class="records">
            <tr>
                <td><div class="amount">xxx</div>
                    <div class="label">Total Records</div></td>
                <td><div class="amount">xxx</div>
                    <div class="label">Full Text</div></td>
                <td><div class="amount">xxx</div>
                    <div class="label">Unique IP<span class="lowercase">s</span> Yesterday</div></td>
            </tr>
        </table>
    </div>
    <h1>$_("Admin Center")</h1>
	<div class="small">
	    <a href="/admin/reload/">Reload Templates</a>
	    | <a href="/admin/block">Block IPs</a>
	    | <a href="/admin/loans">Loans</a>
	</div>
</div>
<div id="contentBody">

    <div class="contentLeft">
        <div class="head rel"> <span class="caption"><a href="/recentchanges/" class="fixthis">Edits Per Day</a></span>
            <h2>Edits</h2>
        </div>
        <div class="chartHolder">
            <div class="chartDisplay">
	      <div id="edits" style="width:430px;height:50px;">
		<!-- Edit graphs go here -->
	      </div>
            </div>
        </div>
        <table class="measurements stripeEven" id="edits">
            <thead>
                <tr>
                    <th></th>
                    <th>Today</th>
                    <th>Yesterday</th>
                    <th>Last 7 days</th>
                    <th>Last 28 days</th>
                </tr>
            </thead>
            <tbody>
                <tr class="major">
                    <td class="type">Human</td>
                    <td class="amount"><strong>$commify(counts.human_edits.latest)</strong></td>
                    <td class="amount">$commify(counts.human_edits.previous)</td>
                    <td class="amount">$commify(counts.human_edits.get_summary(7))</td>
                    <td class="amount">$commify(counts.human_edits.get_summary(28))</td>
                </tr>
                <tr class="even">
                    <td class="type">Bot</td>
                    <td class="amount"><strong>$commify(counts.bot_edits.latest)</strong></td>
                    <td class="amount">$commify(counts.bot_edits.previous)</td>
                    <td class="amount">$commify(counts.bot_edits.get_summary(7))</td>
                    <td class="amount">$commify(counts.bot_edits.get_summary(28))</td>
                </tr>
                <tr class="totals">
                    <td class="type">Total</td>
                    <td class="amount">$commify(counts.bot_edits.latest + counts.human_edits.latest)</td>
                    <td class="amount">$commify(counts.bot_edits.previous + counts.human_edits.previous)</td>
                    <td class="amount">$commify(counts.bot_edits.get_summary(7) + counts.human_edits.get_summary(7))</td>
                    <td class="amount">$commify(counts.bot_edits.get_summary(28) + counts.human_edits.get_summary(28))</td>
                </tr>
            </tbody>
        </table>
             
    </div>

    <div class="contentRight">
        <div class="head rel"> <span class="caption"><a href="/admin/people" class="fixthis">New Accounts Per Day</a></span>
            <h2>Members</h2>
        </div>
        <div class="chartHolder">
            <div class="chartDisplay"><img src="http://home.us.archive.org/~georgeo/mocks/bar.png" />
            </div>
        </div>
        <table class="measurements stripeEven" id="members">
            <thead>
                <tr>
                    <th>Today</th>
                    <th>Yesterday</th>
                    <th>Last 7 days</th>
                    <th>Last 28 days</th>
                    <th class="shift">All Time</th>
                </tr>
            </thead>
            <tbody>
                <tr class="major">
                    <td class="amount"><strong>$commify(stats.members.today)</strong></td>
                    <td class="amount">$commify(stats.members.yesterday)</td>
                    <td class="amount">$commify(stats.members.thisweek)</td>
                    <td class="amount">$commify(stats.members.thismonth)</td>
                    <td class="amount shift"><strong>$:macros.MemberCount()</strong></td>
                </tr>
                <tr class="even">
                    <td class="diff"></td>
                    <td class="diff"><span class="pos">+x.x%</span></td>
                    <td class="diff"><span class="neg">-x.x%</span></td>
                    <td class="diff"><span class="pos">+x.x%</span></td>
                    <td class="diff"></td>
                </tr>
                <tr class="totals">
                    <td class="type">Edit ratio</td>
                    <td class="amount">(Member)</td>
                    <td class="amount">x :</td>
                    <td class="amount">x (Anon)</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h2>Record Counts</h2>

    <table class="measurements stripeEven">
        <tr>
            <th></th>
            <th>Last 7 days</th>
            <th>Last 28 days</th>
            <th>Trend</th>
            <th>Total</th>
        </tr>
        <tr class="major">
            <td>Works</td>
            <td class="amount">$commify(counts.works.get_summary(7))</td>
            <td class="amount">$commify(counts.works.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.works.total)</td>    
        </tr>
        <tr class="major even">
            <td>Editions</td>
            <td class="amount">$commify(counts.editions.get_summary(7))</td> 
            <td class="amount">$commify(counts.editions.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.editions.total)</td>    
        </tr>
        <tr class="major">
            <td>eBooks</td>
            <td class="amount">$commify(counts.ebooks.get_summary(7))</td> 
            <td class="amount">$commify(counts.ebooks.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.ebooks.total)</td>    
        </tr>
        <tr class="major even">
            <td>Covers</td>
            <td class="amount">$commify(counts.covers.get_summary(7))</td> 
            <td class="amount">$commify(counts.covers.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.covers.total)</td>    
        </tr>
        <tr class="major">
            <td>Authors</td>
            <td class="amount">$commify(counts.authors.get_summary(7))</td> 
            <td class="amount">$commify(counts.authors.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.authors.total)</td>    
        </tr>
        <tr class="major even">
            <td>Subjects</td>
            <td class="amount">$commify(counts.subjects.get_summary(7))</td> 
            <td class="amount">$commify(counts.subjects.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.subjects.total)</td>    
        </tr>
        <tr class="major">
            <td>Lists</td>
            <td class="amount">$commify(counts.lists.get_summary(7))</td> 
            <td class="amount">$commify(counts.lists.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.lists.total)</td>    
        </tr>
        <tr class="major even">
            <td>Members</td>
            <td class="amount">$commify(counts.members.get_summary(7))</td>
            <td class="amount">$commify(counts.members.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.members.total)</td>
        </tr>
    </table>


    <div class="clearfix"></div>

    <div id="uniqueIps">
        <div class="measurements">

        <h3>Unique IPs</h3>
            <div class="caption">Yesterday</div>
            <div class="measure large"><strong>xxx</strong></div>
            <div class="caption">Day</div>
            <div class="measure large">xxx</div>
            <div class="caption">Day</div>
            <div class="measure">xxx</div>
            <div class="caption">Day</div>
            <div class="measure">xxx</div>
        </div>
        <div style="float:left;">
            <div id="placeholder" style="width:680px;height:300px;"></div>
            <div id="overview" style="margin-left:50px;margin-top:20px;width:400px;height:50px"></div>
        </div>
    </div>x

    <div class="clearfix"></div>

    <div class="tweets" id="adminTwitter">$:macros.twitter()</div>
            
    <div class="contentSpacer"></div>

    <div class="contentQuarter">
        <!-- Start of Flickr Badge -->
            <table id="flickr_badge_uber_wrapper"> 
                <tr> 
                    <td>
                        <table id="flickr_badge_wrapper"> 
                            <script type="text/javascript" src="http://www.flickr.com/badge_code_v2.gne?count=2&display=random&size=m&layout=v&source=user&user=41108298%40N06"></script> 
                        </table> 
                    </td> 
                </tr> 
            </table> 
        <!-- End of Flickr Badge -->
    </div>

</div>
