$def with (counts)

$ _x = ctx.setdefault('bodyid', 'admin')
$ _x = ctx.setdefault('usergroup', 'admin')

$:macros.Dashboard()
$ stats = get_admin_stats()
<script type="text/javascript"> 
\$(function () {
    var d = $:json_encode(counts.human_edits.get_counts(80, True));
    for (var i = 0; i < d.length; ++i)
      d[i][0] += 60 * 60 * 1000;
    function weekendAreas(axes) {
        var markings = [];
        var d = new Date(axes.xaxis.min);
        d.setUTCDate(d.getUTCDate() - ((d.getUTCDay() + 1) % 7))
        d.setUTCSeconds(0);
        d.setUTCMinutes(0);
        d.setUTCHours(0);
        var i = d.getTime();
        do {
            markings.push({ xaxis: { from: i, to: i + 2 * 24 * 60 * 60 * 1000 } });
            i += 7 * 24 * 60 * 60 * 1000;
        } while (i < axes.xaxis.max);
 
        return markings;
    }
    
    var options = {
       series: {
            bars: { 
                show: true, 
                fill: 1, 
                fillColor: "#748d36",
                color: "#748d36", 
                align: "left",
                barWidth: 24 * 60 * 60 * 1000
            },
            points: { 
                show: false 
            },
            color: "#748d36"
        },
        grid: { 
            hoverable: true,
            show: false
        },
        xaxis: { 
            mode: "time"
        }
    };
 
    var placeholder = \$("#edits");

    var plot = \$.plot(placeholder, [d], options);
    
    function showTooltip(x, y, contents) {
        \$('<div id="chartLabelA">' + contents + '</div>').css( {
            position: 'absolute',
            display: 'none',
            top: y + 12,
            left: x + 12,
            border: '1px solid #ccc',
            padding: '2px',
            backgroundColor: '#efefef',
            color: '#454545',
            fontSize: '11px',
            webkitBoxShadow: '1px 1px 3px #333',
            mozBoxShadow: '1px 1px 1px #000',
            boxShadow: '1px 1px 1px #000'
        }).appendTo("body").fadeIn(200);
    };
    var previousPoint = null;
    placeholder.bind("plothover", function (event, pos, item) {
        \$("#x").text(pos.x);
        \$("#y").text(pos.y.toFixed(0));
        if (item) {
            \$("#chartLabelA").remove();
            var milli = item.datapoint[0];
            var date = new Date(milli);
            var x = date.toDateString(),
                y = item.datapoint[1].toFixed(0);
            if (y == 1) {
                showTooltip(item.pageX, item.pageY,
                    y + " edit on " + x);
            } else {
                 showTooltip(item.pageX, item.pageY,
                    y + " edits on " + x);
            };
        } else {
            \$("#chartLabelA").remove();
        };
    });
});
</script> 

<div id="contentHead">
    <div class="contentRight" style="float:right;">
        <table class="records">
            <tr>
                <td><div class="amount">xxx</div>
                    <div class="label">Total Records</div></td>
                <td><div class="amount">xxx</div>
                    <div class="label">Full Text</div></td>
                <td><div class="amount">xxx</div>
                    <div class="label">Unique IP<span class="lowercase">s</span> Yesterday</div></td>
            </tr>
        </table>
    </div>
    <h1>$_("Admin Center")</h1>
	<div class="small">
	    <a href="/admin/reload/">Reload Templates</a>
	    | <a href="/admin/block">Block IPs</a>
	    | <a href="/admin/loans">Loans</a>
	</div>
</div>
<div id="contentBody">

    <div class="contentLeft">
        <div class="head rel"> <span class="caption"><a href="/recentchanges/" class="fixthis">Edits Per Day</a></span>
            <h2>Edits</h2>
        </div>
        <div class="chartHolder">
            <div class="chartDisplay">
	      <div id="edits" style="width:430px;height:50px;">
		<!-- Edit graphs go here -->
	      </div>
            </div>
        </div>
        <table class="measurements stripeEven" id="edits">
            <thead>
                <tr>
                    <th></th>
                    <th>Today</th>
                    <th>Yesterday</th>
                    <th>Last 7 days</th>
                    <th>Last 28 days</th>
                </tr>
            </thead>
            <tbody>
                <tr class="major">
                    <td class="type">Human</td>
                    <td class="amount"><strong>$commify(counts.human_edits.latest)</strong></td>
                    <td class="amount">$commify(counts.human_edits.previous)</td>
                    <td class="amount">$commify(counts.human_edits.get_summary(7))</td>
                    <td class="amount">$commify(counts.human_edits.get_summary(28))</td>
                </tr>
                <tr class="even">
                    <td class="type">Bot</td>
                    <td class="amount"><strong>$commify(counts.bot_edits.latest)</strong></td>
                    <td class="amount">$commify(counts.bot_edits.previous)</td>
                    <td class="amount">$commify(counts.bot_edits.get_summary(7))</td>
                    <td class="amount">$commify(counts.bot_edits.get_summary(28))</td>
                </tr>
                <tr class="totals">
                    <td class="type">Total</td>
                    <td class="amount">$commify(counts.bot_edits.latest + counts.human_edits.latest)</td>
                    <td class="amount">$commify(counts.bot_edits.previous + counts.human_edits.previous)</td>
                    <td class="amount">$commify(counts.bot_edits.get_summary(7) + counts.human_edits.get_summary(7))</td>
                    <td class="amount">$commify(counts.bot_edits.get_summary(28) + counts.human_edits.get_summary(28))</td>
                </tr>
            </tbody>
        </table>
             
    </div>

    <div class="contentRight">
        <div class="head rel"> <span class="caption"><a href="/admin/people" class="fixthis">New Accounts Per Day</a></span>
            <h2>Members</h2>
        </div>
        <div class="chartHolder">
            <div class="chartDisplay"><img src="http://home.us.archive.org/~georgeo/mocks/bar.png" />
            </div>
        </div>
        <table class="measurements stripeEven" id="members">
            <thead>
                <tr>
                    <th>Today</th>
                    <th>Yesterday</th>
                    <th>Last 7 days</th>
                    <th>Last 28 days</th>
                    <th class="shift">All Time</th>
                </tr>
            </thead>
            <tbody>
                <tr class="major">
                    <td class="amount"><strong>$commify(stats.members.today)</strong></td>
                    <td class="amount">$commify(stats.members.yesterday)</td>
                    <td class="amount">$commify(stats.members.thisweek)</td>
                    <td class="amount">$commify(stats.members.thismonth)</td>
                    <td class="amount shift"><strong>$:macros.MemberCount()</strong></td>
                </tr>
                <tr class="even">
                    <td class="diff"></td>
                    <td class="diff"><span class="pos">+x.x%</span></td>
                    <td class="diff"><span class="neg">-x.x%</span></td>
                    <td class="diff"><span class="pos">+x.x%</span></td>
                    <td class="diff"></td>
                </tr>
                <tr class="totals">
                    <td class="type">Edit ratio</td>
                    <td class="amount">(Member)</td>
                    <td class="amount">x :</td>
                    <td class="amount">x (Anon)</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h2>Record Counts</h2>

    <table class="measurements stripeEven">
        <tr>
            <th></th>
            <th>Last 7 days</th>
            <th>Last 28 days</th>
            <th>Trend</th>
            <th>Total</th>
        </tr>
        <tr class="major">
            <td>Works</td>
            <td class="amount">$commify(counts.works.get_summary(7))</td>
            <td class="amount">$commify(counts.works.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.works.total)</td>    
        </tr>
        <tr class="major even">
            <td>Editions</td>
            <td class="amount">$commify(counts.editions.get_summary(7))</td> 
            <td class="amount">$commify(counts.editions.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.editions.total)</td>    
        </tr>
        <tr class="major">
            <td>eBooks</td>
            <td class="amount">$commify(counts.ebooks.get_summary(7))</td> 
            <td class="amount">$commify(counts.ebooks.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.ebooks.total)</td>    
        </tr>
        <tr class="major even">
            <td>Covers</td>
            <td class="amount">$commify(counts.covers.get_summary(7))</td> 
            <td class="amount">$commify(counts.covers.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.covers.total)</td>    
        </tr>
        <tr class="major">
            <td>Authors</td>
            <td class="amount">$commify(counts.authors.get_summary(7))</td> 
            <td class="amount">$commify(counts.authors.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.authors.total)</td>    
        </tr>
        <tr class="major even">
            <td>Subjects</td>
            <td class="amount">$commify(counts.subjects.get_summary(7))</td> 
            <td class="amount">$commify(counts.subjects.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.subjects.total)</td>    
        </tr>
        <tr class="major">
            <td>Lists</td>
            <td class="amount">$commify(counts.lists.get_summary(7))</td> 
            <td class="amount">$commify(counts.lists.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.lists.total)</td>    
        </tr>
        <tr class="major even">
            <td>Members</td>
            <td class="amount">$commify(counts.members.get_summary(7))</td>
            <td class="amount">$commify(counts.members.get_summary(28))</td>
            <td><img src="http://home.us.archive.org/~georgeo/mocks/spark.png" /></td>
            <td class="amount">$commify(counts.members.total)</td>
        </tr>
    </table>


    <div class="clearfix"></div>

    <div id="uniqueIps">
        <div class="measurements">

        <h3>Unique IPs</h3>
            <div class="caption">Yesterday</div>
            <div class="measure large"><strong>xxx</strong></div>
            <div class="caption">Day</div>
            <div class="measure large">xxx</div>
            <div class="caption">Day</div>
            <div class="measure">xxx</div>
            <div class="caption">Day</div>
            <div class="measure">xxx</div>
        </div>
        <div style="float:left;">
            <div id="placeholder" style="width:680px;height:300px;"></div>
            <div id="overview" style="margin-left:50px;margin-top:20px;width:400px;height:50px"></div>
        </div>
    </div>x

    <div class="clearfix"></div>

    <div class="tweets" id="adminTwitter">$:macros.twitter()</div>
            
    <div class="contentSpacer"></div>

    <div class="contentQuarter">
        <!-- Start of Flickr Badge -->
            <table id="flickr_badge_uber_wrapper"> 
                <tr> 
                    <td>
                        <table id="flickr_badge_wrapper"> 
                            <script type="text/javascript" src="http://www.flickr.com/badge_code_v2.gne?count=2&display=random&size=m&layout=v&source=user&user=41108298%40N06"></script> 
                        </table> 
                    </td> 
                </tr> 
            </table> 
        <!-- End of Flickr Badge -->
    </div>

</div>
