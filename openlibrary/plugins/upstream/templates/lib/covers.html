$def with (page)

$ covers = page.get_covers(limit=12*3)

<script type="text/javascript">
var page = new Place("$page.key");
page.bookCount = $page.work_count;
page.covers[0] = $:json_encode(covers[:12]);
page.covers[1] = $:json_encode(covers[12:24]);
page.covers[2] = $:json_encode(covers[24:36]);

function createTemplate(selector) {
    var code = \$(selector).html()
                    .replace(/{{/g, "<%=")
                    .replace(/}}/g, "%>");
    return Template(code);
}

page.displayCovers = function(pagenum) {
    page.getCovers(0, function(covers) {
        \$("#coversCarousel").empty().html(page.renderCovers({'covers': covers}));
    });
};

function loadCoverCarousels(carousel, state) {
    if (!page.coverCarousel) {
        page.coverCarousel = carousel;
    }
    var index = carousel.first;
    page.pos = (index-1)*12;
    
    if (carousel.has(index)) {
        return;
    }
    //console.log("load", index);
    //carousel.size(10);
    carousel.add(index, "Finding more books...");
    page.getCovers(index-1, function(covers) {
        //console.log("load callback", index, covers);
        carousel.add(index, page.renderCovers({'covers': covers}));
    });
}

\$().ready(function() {
    page.renderCovers = createTemplate("#covers-tmpl");    
    page.displayCovers(0);
});

\$().ready(carousels);
\$().ready(function() {
    carouselSetup(loadCoverCarousels);
});
</script>

<script type="text/html" class="jstemplate" id="covers-tmpl">
<% for (var i=0; i<covers.length; i++) { %>
    <% 
        var cover = covers[i]; 
        var authors = [];
        for (var j in cover.authors)
            authors.push(cover.authors[j].name);
    %>
    <div class="coverMagic">
        <% if (cover.cover_edition_key) { %>
            <div class="SRPCover">
                <a href="{{cover.key}}" title="{{cover.title}}, {{cover.edition_count}} editions"><img src="http://covers.openlibrary.org/b/olid/{{cover.cover_edition_key}}-M.jpg" alt="{{cover.title}}" class="cover"/></a>
            </div>
        <% } else { %>
            <div class="SRPCoverBlank" onclick="document.location.href='{{cover.key}}';" title="{{cover.title}}, {{cover.edition_count}} editions" style="display:block;">
                <div class="innerBorder">
                    <div class="BookTitle">{{truncate(cover.title, 40)}}
                        <div class="Author">{{truncate(authors.join(", "), 40)}}</div>
                    </div>
                </div>
            </div>
        <% } %>
        <% if (cover.has_fulltext) { %>
            <div class="coverEbook" onclick="document.location.href='http://archive.org/stream/{{cover.ia}}';" title="Read online"></div>
        <% } %>
    </div>
<% } %>
</script>

<div id="contentLists" class="results">
    <div class="covers" id="resultsCovers">
        <ul id="coversCarousel" class="jcarousel-skin-OL">
        </ul>
    </div>
</div>

<div class="clearfix"></div>