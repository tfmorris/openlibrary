$def with (work, edition=None)

$var title: $work.title
$putctx("robots", "noindex,nofollow")

<script type="text/javascript">
\$().ready(Tabs);
\$().ready(function(){
    if(jQuery.support.opacity){
        \$("#tabsAddbook").tabs({fx:{opacity:'toggle'}});
    } else {
        \$("#tabsAddbook").tabs();
    };
});
\$().ready(boxPop);
\$().ready(function(){\$("#coverPop").colorbox({inline:true, href:"#addCover"});});

function limitChars(textid, limit, infodiv) {
    var text = \$('#'+textid).val(); 
    var textlength = text.length;
    if(textlength > limit) {
        \$('#'+infodiv).html('Maximum length is '+limit+' characters');
        \$('#'+textid).val(text.substr(0,limit));
        return false;
    } else {
        \$('#'+infodiv).html('You have '+ (limit - textlength) +' characters left');
        return true;
    }
};
\$().ready(function(){\$('#excerpt').keyup(function(){limitChars('excerpt', 2000, 'charLimit');});});

\$().ready(function() {
    var hash = document.location.hash || "#edition";
    var fieldname = hash.replace('/', '-');
    var link = "#" + "link_" + hash.substr(1).split("/")[0];
    
    \$(link).click();
        
    // input field is enabled only after the tab is selected and that takes some time after clicking the link.
    // wait for 1 sec after clicking the link and focus the input field
    setTimeout(function() {
        \$(fieldname).focus();
    }, 1000);
});

\$().ready(function() {
    \$("textarea.markdown").wmd();
});
</script>
<div id="contentHead">
    $if work.revision == 1:
        <div class="head">
            <h1>$_("Add a little more?")</h1>
        </div>
        <p class="instruct">$_("OK. That's the very beginning of a new record saved. The Open Library can hold a lot more detail about books though, so if you're interested, please help us fill in the gaps!")</p>
    $else:
        <div class="head">
            <h1>$_("Edit %s", work.title)</h1>
        </div>
    
</div>

<div id="contentBody">
    <form method="post" id="addWork" class="olform books" name="edit">
        <div class="TitleAuthor sansserif">
            <div class="titleFloat">
                <label for="work-title">Title</label>
                <input name="work--title" type="text" id="work-title" value="$work.title"/>
            </div>
            <div class="titleFloat middle">
                <strong>by</strong>
            </div>
            <div class="titleFloat fixthis">
                <label for="author">Author</label>
                $ author = work.authors and work.authors[0].author
                $ author_name = author and author.name
                <input name="author" class="required author author-autocomplete" type="text" id="author" value="$author_name" />
                <input name="work--authors--0--author--key" type="hidden" id="author-key" value="$(author and author.key)" />
                $for i, a in enumerate(work.authors):
                    $if i > 0:
                        <input name="work--authors--$i--author--key" type="hidden" id="author-key" value="$(a.author.key)" />
            </div>
        </div>
        
<script type="text/javascript">
function find_matching_authors(name) {
    // dummy name for testing no records found
    if (name == "newauthor")
        return [];
        
    // return dummy data for now
    return [
        {"key": "/authors/OL1A", "name": name}, 
        {"key": "/authors/OL2A", "name": name + '_1'}, 
        {"key": "/authors/OL3A", "name": name + '_2'}, 
        {"key": "/authors/OL4A", "name": name + '_3'}, 
    ]
}
</script>

        <div id="tabsAddbook">
            <ul>
                <li><a href="#about" id="link_about">$_("What's It About?")</a></li>
                <li><a href="#excerpts" id="link_excerpts">$_("Add Excerpts")</a></li>
                <li><a href="#web" id="link_web">$("Web Resources")</a></li>
                $if edition:
                    $if edition.publishers:
                        $ edition_name = "; ".join(edition.publishers) + ' edition'
                    $else:
                        $ edition_name = "Unknown publisher" + ' edition'
                    
                    $if edition.publish_date:
                        $ edition_name = truncate(edition_name, 20) + ", " + edition.publish_date
                    
                    <li><a href="#edition" id="link_edition">$edition_name</a></li>
            </ul>

            <div id="about">
                $:render_template("books/edit/about", work)
            </div>

            <div id="excerpts">
                $:render_template("books/edit/excerpts", work)
            </div>

            <div id="web">
                $:render_template("books/edit/web", work, prefix="work--")
            </div>
        
            $if edition:
                <div id="edition">
                    $:render_template("books/edit/edition", edition)
                </div>
        </div>

        $:macros.EditButtons(comment=work.comment_)        
    </form>

    $if edition:
        $:render_template("books/edit/addfield", edition)

    $:render_template("lib/history", work)

</div>