$def with (page, action=None, title=None)

$ _t = i18n.get_namespace('/type/edition')
$ _ = i18n.get_namespace('/mode/edit')

$ title = title or safeadd(_.editing, ' ', page.title)

$ _x = ctx.setdefault('bodyid', 'edit')
 
$var title: $title



<script type="text/javascript">
<!--
function next(key) {
    if (!key)
       return "";
    
    var tokens = key.split('#');

    try { 
        if (tokens.length == 2) {
             var prefix = tokens[0];
             tokens = tokens[1].split('.');
             var x = tokens[0];
             var suffix = tokens[1];

             x = prefix + '#' + (1 + eval(x)); // there must be better way to convert a string to integer than using eval
             if (suffix) {
                 x = x + '.' + suffix;
             }
             return x;
        }
    }
    catch (e) {
    }
    return key;
}


-->
</script>

<form method="POST" name="edit" class="oledit olform" action="$(action or '')">

    <div id="contentHead">
        <div class="head">
           <h3>$_.pretitle:</h3>
           <h1>$page.title</h1>
        </div>
    </div>


    <div id="contentBody">
        $:macros.TypeChanger(page.type)

    <!-- WIKI EDIT SECTION -->
                    
                    $:macros.EditionEditRow(page, 'title_prefix', True)
                    $:macros.EditionEditRow(page, 'title', True)
                    $:macros.EditionEditRow(page, 'subtitle', True)
                    $:macros.EditionEditRow(page, 'by_statement', True)
                    $:macros.EditionEditRow(page, 'authors', False)
                    $:macros.EditionEditRow(page, 'contributions', False)

                    $:macros.EditionEditRow(page, 'publish_date', True)
                    $:macros.EditionEditRow(page, 'publishers', False)
                    $:macros.EditionEditRow(page, 'publish_places', False)

                    $:macros.EditionEditRow(page, 'series', False)
                    $:macros.EditionEditRow(page, 'edition_name', True)
                    $:macros.EditionEditRow(page, 'languages', False)
                    $:macros.EditionEditRow(page, 'work_titles', False)
                    $:macros.EditionEditRow(page, 'collections', False)
                    $:macros.EditionEditRow(page, 'uris', False)
                    $:macros.EditionEditRow(page, 'works', False)


                    <!-- ADDITIONAL METADATA -->

        <div class="formElement">
            <div class="label"><label for="pagination">$_t.pagination</label></div>
            <div class="input"><input type="text" name="pagination" id="pagination" value="$page['pagination']"  size="8" /></div>
        </div>

        <div class="formElement">
            <div class="label"><label for="physical_dimensions">$_t.size</label></div>
            <div class="input"><input type="text" name="physical_dimensions" id="physical_dimensions" value="$page['physical_dimensions']" size="8" /></div>
        </div>

        <div class="formElement">
            <div class="label"><label for="physical_format">$_t.physical_format</label></div>
            <div class="input"><input type="text" name="physical_format" id="physical_format" value="$page['physical_format']" size="8" /></div>
        </div>

        <div class="formElement">
            <div class="label"><label for="number_of_pages">$_t.number_of_pages</label></div>
            <div class="input"><input type="text" name="number_of_pages" id="number_of_pages" value="$page['number_of_pages']"  size="8" /></div>
        </div>

        <div class="formElement">
            <div class="label"><label for="weight">$_t.weight</label></div>
            <div class="input"><input type="text" name="weight" id="weight" value="$page['weight']"  size="8" /></div>
        </div>

        <div class="formElement">
            <div class="label"><label for="description">$_t.description</label></div>
            <div class="input"><textarea name="description" id="description" rows="6" cols="20">$page.description</textarea></div>
        </div>

        <div class="formElement">
            <div class="label"><label for="first_sentence">$_t.first_sentence</label></div>
            <div class="input"><textarea name="first_sentence" id="first_sentence" rows="6" cols="20">$page.first_sentence</textarea></div>
        </div>

        <div class="formElement">
            <div class="label"><label for="notes">$_t.notes</label></div>
            <div class="input"><textarea name="notes" id="notes" rows="6" cols="20">$page.notes</textarea></div>
        </div>


                <table>
                    <tr> <!-- begin table of contents -->
                        <td>
                        
                        </td>
                    </tr> <!-- end table of contents -->
                </table> <!-- end left table -->

                $ olid = page.key.split('/')[-1]
                $if olid:
                    <div><img width="180" src="http://covers.openlibrary.org/b/olid/$olid-M.jpg"/></div>
                    <div><button onclick="change_cover();" type="button">Change Cover</button></div>

<script type="text/javascript">
function change_cover() {
    window.location.href = "$:changequery(m='change_cover')";
}
</script>

                <br />

                    $:macros.EditionEditRow(page, "dewey_decimal_class", unique=False, right=True)
                    $:macros.EditionEditRow(page, "lc_classifications", unique=False, right=True)
                    $:macros.EditionEditRow(page, "isbn_10", unique=False, right=True)
                    $:macros.EditionEditRow(page, "isbn_13", unique=False, right=True)
                    $:macros.EditionEditRow(page, "lccn", unique=False, right=True)
                    $:macros.EditionEditRow(page, "ocaid", unique=True, right=True)
                    $:macros.EditionEditRow(page, "oclc_numbers", unique=False, right=True)

                    $:macros.EditionEditRow(page, "subjects", unique=False, right=True)
                    $:macros.EditionEditRow(page, "genres", unique=False, right=True)
            
        <!-- edit summary and buttons -->
                    $:macros.EditButtons(comment=page.comment_)

</form>

$if page.key:
        <div class="smaller sansserif">
            <a href="/clonebook?key=$page.key">$_.clone_book</a>
        </div>

    </div>