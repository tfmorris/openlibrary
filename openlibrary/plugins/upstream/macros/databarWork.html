$def with (page)

$ booksense = "http://booksense.com/product/info.jsp?isbn=XXX"
$ amazon = "http://www.amazon.com/gp/product/XXX?tag=openlibr-20"
$ abebooks = "http://clickserve.cc-dt.com/link/tplclick?lid=41000000024660875&pubid=21000000000172077&isbn=XXX"
$ alibris = " http://click.linksynergy.com/fs-bin/click?id=eSmaWuUpnDY&offerid=99238.122856000&type=2&subid=0&tmpid=939&RD_PARM1=http%253A%252F%252Fwww.alibris.com/booksearch%253Fqsort%253Dp%2526isbn%253DXXX"
$ barnesandnoble = "http://search.barnesandnoble.com/booksearch/isbninquiry.asp?ISBN=XXXafsrc=1&lkid=J14933426&pubid=K172077"
$ powells = "http://www.powells.com/partner/33286/biblio/XXX"

$ worldcat = "http://worldcat.org/isbn/XXX"
$ worldcatoclc = "http://worldcat.org/oclc/XXX"
$ bookmooch = "http://www.bookmooch.com/m/mooch_choice?asin=XXX"
$ titletrader = "http://www.titletrader.com/invinfo/XXX.html"

$ viewbook = "http://www.archive.org/stream/XXX"
$ detailbook = "http://www.archive.org/details/XXX"
$ downloadbook = "http://www.archive.org/download/XXX/XXX.pdf"
$ djvu = "http://www.archive.org/stream/XXX/XXX.djvu"
$ djvutxt = "http://www.archive.org/download/XXX/XXX_djvu.txt"
$ seeall = "http://www.archive.org/download/XXX"
$ google = ""

$ isbn_10 = (page.isbn_10 and page.isbn_10[0]) or ""
$ oclc_numbers = (page.oclc_numbers and page.oclc_numbers[0]) or ""

<div id="Tools">

$if page.volumes:
    <div>
    <h3 class="header">
        <span class="icon read"></span>
        <span class="head blue">Browse</span>
        <span class="subhead">on <span class="blue">Internet Archive</span></span>
    </h3>
    $for v in page.volumes:
        $if v.ia_id != "-":
            <div class="panel">
                <p><a href="$viewbook.replace('XXX', v.ia_id)">View Volume $v.volume_number</a></p>
            </div>
            </div>
$elif page.get('ocaid'):
    <div>
    <h3 class="header">
        <span class="icon read"></span>
        <span class="head blue">Read</span>
        <span class="subhead">on <span class="blue" onclick="location.href='$detailbook.replace('XXX', page.ocaid)';">Internet Archive</span></span>
    </h3>
    <div class="panel">
        <table><tbody>
            <tr>
                <td class="vendor"><a href="$viewbook.replace('XXX', page.ocaid)">Bookscanner</a> (Best method)</td>
            </tr>
            <tr>
                <td class="vendor"><a href="$djvu.replace('XXX', page.ocaid)">DjVu</a> (Requires Java)</td>
            </tr>
            <tr>
                <td class="vendor"><a href="$djvutxt.replace('XXX', page.ocaid)">Plain text</a></td>
            </tr>
            <tr>
                <td class="vendor"><a href="$seeall.replace('XXX', page.ocaid)">View all available methods</a></td>
            </tr>
        </tbody></table>
    </div>
    </div>
    <div>
    <h3 class="header">
        <span class="icon download"></span>
        <span class="head blue">Download</span>
        <span class="subhead">available</span>
    </h3>
    <div class="panel">
        <p><a href="$downloadbook.replace('XXX', page.ocaid)">Download a PDF</a></p>
    </div>
    </div>
$else:
    <div>
    <h3 class="closed">
        <span class="icon readinact"></span>
        <span class="head">Read</span>
        <span class="subhead">is unavailable</span>
    </h3>
    </div>

$if isbn_10:
    <div>
    <h3 class="header">
        <span class="icon buy"></span>
        <span class="head blue">Buy</span>
        <span class="subhead">$0.00 - $00.00</span>
    </h3>
    <div class="panel">
        <table>
            <tbody>
                <tr>
                    <td class="vendor"><a href="$amazon.replace('XXX', isbn_10)" class="datalink">Amazon</a></td>
                    <td class="price">$0.00</td>
                </tr>
                <tr>
                    <td class="vendor"><a href="$abebooks.replace('XXX', isbn_10)" class="datalink">Abebooks</a></td>
                    <td class="price">$0.00</td>
                </tr>
                <tr>
                    <td class="vendor"><a href="$alibris.replace('XXX', isbn_10)" class="datalink">Alibris</a></td>
                    <td class="price">$0.00</td>
                </tr>
                <tr>
                    <td class="vendor"><a href="$barnesandnoble.replace('XXX', isbn_10)" class="datalink">Barnes and Noble</a></td>
                    <td class="price">$0.00</td>
                </tr>
                <tr>
                    <td class="vendor"><a href="$powells.replace('XXX', isbn_10)" class="datalink">Powells</a></td>
                    <td class="price">$0.00</td>
                </tr>
            </tbody>
        </table>
    </div>
    </div>
$else:
    <div>
    <h3 class="closed">
        <span class="icon buyinact"></span>
        <span class="head">Buy</span>
        <span class="subhead">is unavailable</span>
    </h3>
    </div>

$if isbn_10:
    <div>
    <h3 onclick="location.href='$worldcat.replace('XXX', isbn_10)';">
        <span class="icon borrow"></span>
        <span class="head blue">Borrow</span>
        <span class="subhead">from your local library</span>
    </h3>
    </div>
$elif oclc_numbers:
    <div>
    <h3 onclick="location.href='$worldcatoclc.replace('XXX', oclc_numbers)';">
        <span class="icon borrow"></span>
        <span class="head blue">Borrow</span>
        <span class="subhead">from your local library</span>
    </h3>
    </div>
$else:
    <div>
    <h3 class="closed">
        <span class="icon borrowinact"></span>
        <span class="head">Borrow</span>
        <span class="subhead">is unavailable</span>
    </h3>
    </div>

    <div>
    <h3 onclick="location.href='/lists';">
        <span class="icon list"></span>
        <span class="head">List</span>
        <span class="subhead">Make this a favorite</span>
    </h3>
    </div>

    <div>
    <h3 class="closed">
        <span class="icon" style="background-image:url('');"></span>
        <span class="head">Build</span>
        <span class="subhead">
            <strong>Help us build Open Library</strong><br/>
            To succeed, Open Library needs the help of thousands (or maybe millions!) of volunteers. It's easy!<br/>
            <ul style="margin-left:1.25em;margin-top:5px;">
                <li style="list-style:disc;padding-bottom:5px;"><a href="#">Add an Edition</a></li>
                <li style="list-style:disc;padding-bottom:5px;"><a href="#">Add some web links</a></li>
                <li style="list-style:disc;padding-bottom:5px;"><a href="#">Add or edit Work info</a></li>
            </ul>
        </span>
    </h3>
    </div>

</div>