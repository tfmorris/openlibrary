$def with (author=None, type=None, limit=50)

$ page = safeint(query_param('page', '0'))
$ ip = query_param('ip', None)
$ changes = get_recent_changes(author=author, type=type, ip=ip, limit=limit, offset=page * limit)

$ show_users = (query_param('show_users', 'false').lower() == 'true')

<!--islist-->

    <table id="changeHistory">
        <thead>
            <tr>
                <th>$_("When")</th>
                <th>$_("Path")</th>
                <th>$_("Who")</th>
                <th>$_("What")</th>
                <th>$_("Actions")</th>
            </tr>
        </thead>
        <tbody>
        $for v in changes:
            $# ignore user registrations
            $if show_users or not v.key.startswith('/user/'):
                <tr>
                    <td class="time">$datestr(v.created)</td>
                    $# show book title/author name instead of key
                    $if v.thing.type.key == '/type/edition':
                        $ name = v.thing.title
                    $elif v.thing.type.key == '/type/author':
                        $ name = v.thing.name
                    $else:
                        $ name = v.key
                    <td class="path"><div class="truncatepath"><a href="$homepath()$v.key" class="datalink" title="$v.key">$:macros.TruncateString(name, 35)</a></div></td>
                    $if v.author:
                        <td class="displayname"><div class="truncatedisplayname"><a href="$homepath()$v.author.key" class="truncate" title="$v.author.displayname">$v.author.displayname</a></div></td>
                    $elif v.ip and v.ip != '127.0.0.1':
                        <td class="history"><a href="/recentchanges?ip=$v.ip">$v.ip</a></td>
                    $else:
                        <td class="history">$v.ip</td>
                    <td class="comment">$v.comment</td>
                    <td class="buttons" nowrap="nowrap">
                        <a href="$homepath()$v.key?m=view&v=$v.revision">$_("view")</a> -
                        <a href="$homepath()$v.key?m=edit&v=$v.revision">$_("edit")</a> - 
                        <a href="$homepath()$v.key?m=diff&b=$v.revision">$_("diff")</a>
                    </td>
                </tr>
        </tbody>
    </table>

    <div class="small sansserif">
    $if page != 0:
        <a href="$:changequery(page=page - 1)" rel="nofollow">$_("Newer")</a>
    
    $if len(changes) == limit:
        &nbsp; <a href="$:changequery(page=page + 1)" rel="nofollow">$_("Older")</a>
    </div>